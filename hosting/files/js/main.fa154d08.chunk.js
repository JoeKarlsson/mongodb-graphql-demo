(this["webpackJsonpmongodb-graphql-demo"]=this["webpackJsonpmongodb-graphql-demo"]||[]).push([[0],{36:function(e,t,n){e.exports=n.p+"static/media/plus.e50b7210.svg"},58:function(e,t,n){e.exports=n(83)},80:function(e,t,n){e.exports=n.p+"static/media/close.ff987521.svg"},82:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(38),c=n.n(o),i=n(28),l=n.n(i),s=n(21),u=n(23),m=n(24),d={APP_ID:"graphql-demo-lrpvu"},p=d.APP_ID,g=m.b.hasAppClient(p)?m.b.getAppClient(p):m.b.initializeAppClient(p,{baseUrl:"https://stitch.mongodb.com"});function f(){var e=new m.a;return g.auth.loginWithCredential(e).then((function(e){return console.log("Logged in as anonymous user with id: ".concat(e.id)),e})).catch(console.error)}function b(){return g.auth.isLoggedIn}function h(){return g.auth.isLoggedIn?g.auth.user:null}function v(){var e=h();return g.auth.logoutUserWithId(e.id)}var E=r.a.createContext();function w(){var e=r.a.useContext(E);if(!e)throw new Error("useStitchAuth must be used within a StitchAuthProvider");return e}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var x=n(8),y=n(16),k=n(19),I=n(17),j=n(15),O=n(18),L=n.n(O),N=n(46),C=n(47),U=n(56),A=n(48),P=n(57),_=function(e){function t(){return Object(N.a)(this,t),Object(U.a)(this,Object(A.a)(t).apply(this,arguments))}return Object(P.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return r.a.createElement(y.b,{className:"bg-white ma3 box post flex flex-column no-underline br2",to:"/post/".concat(this.props.post._id)},r.a.createElement("div",{className:"image",style:{backgroundImage:"url(".concat(this.props.post.imageUrl,")"),backgroundSize:"cover",backgroundPosition:"center",paddingBottom:"100%"}}),r.a.createElement("div",{className:"flex items-center black-80 fw3 description"},this.props.post.description))}}]),t}(r.a.Component),q=function(e){var t=w(),a=t.isLoggedIn,o=t.actions,c=o.handleLogout,i=o.handleAnonymousLogin,l="";return"/"!==e.location.pathname&&(l=" blur"),r.a.createElement("div",{className:"w-100 flex justify-center pa6"+l},r.a.createElement("div",{className:"w-100 flex flex-wrap",style:{maxWidth:1150}},!a&&r.a.createElement("button",{className:"ma3 box new-post br2 flex flex-column items-center justify-center ttu fw6 f20 black-30 no-underline",onClick:i},r.a.createElement("img",{src:n(36),alt:"",className:"plus mb3"}),r.a.createElement("div",null,"Log In as a Guest User")),r.a.createElement(y.b,{to:"/create",className:"ma3 box new-post br2 flex flex-column items-center justify-center ttu fw6 f20 black-30 no-underline"},r.a.createElement("img",{src:n(36),alt:"",className:"plus mb3"}),r.a.createElement("div",null,"New Post")),e.instaposts&&e.instaposts.map((function(t){return r.a.createElement(_,{key:t.id,post:t,refresh:function(){return e.instaposts.refetch()}})})),a&&r.a.createElement("button",{className:"ma3 box new-post br2 flex flex-column items-center justify-center ttu fw6 f20 black-30 no-underline",onClick:c},r.a.createElement("img",{src:n(36),alt:"",className:"plus mb3"}),r.a.createElement("div",null,"Log Out"))),e.children)},B=function(){return r.a.createElement("div",{className:"flex w-100 h-100 items-center justify-center pt7"},r.a.createElement("div",null,"Loading data from the MongoDB GraphQL endpoint..."))};function D(){var e=Object(I.a)(["\n\tquery {\n\t\tinstaposts {\n\t\t\t_id\n\t\t\tdescription\n\t\t\timageUrl\n\t\t}\n\t}\n"]);return D=function(){return e},e}var S=L()(D());var W=function(e){var t=Object(j.b)(S,{pollInterval:500}),n=t.loading,o=t.error,c=t.data;return r.a.createElement(a.Fragment,null,n&&r.a.createElement(B,null),o&&r.a.createElement("div",null,"encountered an error: ".concat(o)),c&&r.a.createElement(q,Object.assign({},c,e)))},z=n(33),$=n.n(z),F={overlay:{zIndex:20,backgroundColor:"rgba(255,255,255,.6)",display:"flex",alignItems:"center",justifyContent:"center"},content:{position:"relative",width:600,height:"auto",top:"initial",left:"initial",right:"initial",bottom:"initial",borderRadius:2,padding:0,border:"none",background:"none",boxShadow:"0 1px 7px rgba(0,0,0,.2)"}};function G(){var e=Object(I.a)(["\n\tmutation CreatePostMutation($data: InstapostInsertInput!) {\n\t\tinsertOneInstapost(data: $data) {\n\t\t\t_id\n\t\t\tdescription\n\t\t\timageUrl\n\t\t}\n\t}\n"]);return G=function(){return e},e}var M=L()(G());var Q=Object(k.e)((function(e){var t={value:""},n="",a=Object(j.a)(M),o=Object(u.a)(a,1)[0];return r.a.createElement($.a,{isOpen:!0,contentLabel:"Create Post",ariaHideApp:!1,style:F,onRequestClose:e.history.goBack},r.a.createElement("div",{className:"pa4 flex justify-center bg-white"},r.a.createElement("div",{style:{maxWidth:400},className:""},r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),o({variables:{data:{description:n.value,imageUrl:t.value}}}),e.history.replace("/")}}," ",r.a.createElement("input",{className:"w-100 pa3 mv2",id:"imageUrl",ref:function(e){t=e},placeholder:"Image Url",autoFocus:!0}),r.a.createElement("input",{className:"w-100 pa3 mv2",id:"description",placeholder:"Description",ref:function(e){n=e}}),r.a.createElement("button",{className:"pa3 bg-black-10 bn dim ttu pointer",type:"submit"},"Post")))))})),R=function(e){return r.a.createElement(Q,e)};function H(){var e=Object(I.a)(["\n\tmutation deleteOneInstapost($data: InstapostQueryInput!) {\n\t\tdeleteOneInstapost(query: $data) {\n\t\t\t_id\n\t\t\tdescription\n\t\t\timageUrl\n\t\t}\n\t}\n"]);return H=function(){return e},e}var J={overlay:F.overlay,content:Object(s.a)({},F.content,{height:761})},T=L()(H());var K=Object(k.e)((function(e){var t=Object(j.a)(T),a=Object(u.a)(t,1)[0],o=e.instapost;return r.a.createElement($.a,{isOpen:!0,ariaHideApp:!1,contentLabel:"Create Post",style:J,onRequestClose:e.history.goBack},r.a.createElement("div",{className:"close fixed right-0 top-0 pointer",onClick:e.history.goBack},r.a.createElement("img",{src:n(80),alt:""})),r.a.createElement("div",{className:"delete ttu white pointer fw6 absolute left-0 top-0 br2",onClick:function(t){a({variables:{data:{_id:o._id}}}),e.history.replace("/")}},"Delete"),r.a.createElement("div",{className:"bg-white detail flex flex-column no-underline br2 h-100"},r.a.createElement("div",{className:"image",style:{backgroundImage:"url(".concat(o.imageUrl,")"),backgroundSize:"cover",backgroundPosition:"center",paddingBottom:"100%"}}),r.a.createElement("div",{className:"flex items-center black-80 fw3 description"},o.description)))}));function V(){var e=Object(I.a)(["\n\t\t\tquery PostsQuery {\n\t\t\t\tinstapost {\n\t\t\t\t\t_id\n\t\t\t\t\timageUrl\n\t\t\t\t\tdescription\n\t\t\t\t}\n\t\t\t}\n\t\t"]);return V=function(){return e},e}var X=function(e){var t=e.match.params._id,n=Object(j.b)(L()(V()),{variables:{_id:t}}),a=n.loading,o=n.error,c=n.data;return r.a.createElement("div",{className:"App"},a&&r.a.createElement(B,null),o&&r.a.createElement("div",null,"encountered an error: ".concat(o)),c&&r.a.createElement(K,Object.assign({},c,e)))},Y=n(87),Z=n(26),ee=n(86),te=n(55),ne=function(){if(b(),b()||f(),b()){var e=h().auth.activeUserAuthInfo.accessToken,t=Object(te.a)((function(t,n){var a=n.headers;return{headers:Object(s.a)({},a,{Authorization:"Bearer ".concat(e)})}})),n="https://stitch.mongodb.com/api/client/v2.0/app/".concat(d.APP_ID,"/graphql"),a=new Y.a({uri:n});return new Z.a({link:t.concat(a),cache:new ee.a})}};function ae(){var e=w().actions;return r.a.createElement("button",{onClick:e.handleAnonymousLogin},"Log In as a Guest User")}function re(){var e=ne();return r.a.createElement(x.a,{client:e},r.a.createElement(y.a,null,r.a.createElement("div",null,r.a.createElement(k.a,{exact:!0,path:"/",component:W}),r.a.createElement(k.a,{path:"/post/:id",component:X}),r.a.createElement(k.a,{path:"/create",component:R}))))}var oe=function(){var e=w(),t=e.isLoggedIn;return(0,e.actions.handleAnonymousLogin)(),r.a.createElement(a.Fragment,null,t?r.a.createElement(re,null):r.a.createElement(ae,null))};n(81),n(82);c.a.render(r.a.createElement((function(e){var t=r.a.useState({isLoggedIn:b(),currentUser:h()}),n=Object(u.a)(t,2),a=n[0],o=n[1],c=function(){var e;return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.isLoggedIn){t.next=12;break}return t.prev=2,t.next=5,l.a.awrap(f());case 5:return e=t.sent,t.abrupt("return",o(Object(s.a)({},a,{isLoggedIn:!0,currentUser:e})));case 9:t.prev=9,t.t0=t.catch(2),console.error(t.t0);case 12:case"end":return t.stop()}}),null,null,[[2,9]])},i=function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.isLoggedIn){e.next=7;break}return e.next=4,l.a.awrap(v());case 4:o(Object(s.a)({},a,{isLoggedIn:!1,currentUser:null})),e.next=8;break;case 7:console.log("can't handleLogout when no user is logged in");case 8:case"end":return e.stop()}}))},m=r.a.useMemo((function(){return{isLoggedIn:a.isLoggedIn,currentUser:a.currentUser,actions:{handleAnonymousLogin:c,handleLogout:i}}}),[a,c,i]);return r.a.createElement(E.Provider,{value:m},e.children)}),null,r.a.createElement(oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[58,1,2]]]);
//# sourceMappingURL=main.fa154d08.chunk.js.map